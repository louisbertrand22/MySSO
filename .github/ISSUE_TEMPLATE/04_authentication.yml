name: "√âtape 4 - Authentification (Password Hash + Login + JWT)"
description: "Impl√©menter la logique d‚Äôauthentification : hash du mot de passe, login, g√©n√©ration et v√©rification des JWT/refresh tokens."
title: "[√âtape 4] Authentification et JWT"
labels:
  - backend
  - auth
  - jwt
  - √©tape-4
assignees:
  - copilothub[bot]
body:
  - type: markdown
    attributes:
      value: |
        ## üîê √âtape 4 - Authentification (Password Hash + JWT)

        Cette √©tape impl√©mente la logique d'authentification pour ton SSO :
        - Hashage s√©curis√© des mots de passe avec bcrypt
        - Endpoint `/register` pour cr√©er un utilisateur
        - Endpoint `/login` pour authentifier un utilisateur
        - G√©n√©ration d‚Äôun JWT (access token) et d‚Äôun refresh token
        - V√©rification de la validit√© du token pour les routes prot√©g√©es

  - type: textarea
    id: dependencies
    attributes:
      label: D√©pendances √† installer
      description: Liste des paquets n√©cessaires pour la gestion du hash et des tokens JWT.
      value: |
        ```bash
        npm install bcrypt jsonwebtoken
        npm install --save-dev @types/jsonwebtoken @types/bcrypt
        ```
    validations:
      required: true

  - type: textarea
    id: auth_logic
    attributes:
      label: Structure de la logique d'authentification
      description: Exemple de logique √† impl√©menter (hash, login, JWT).
      value: |
        ```ts
        import bcrypt from "bcrypt"
        import jwt from "jsonwebtoken"
        import { PrismaClient } from "@prisma/client"

        const prisma = new PrismaClient()
        const JWT_SECRET = process.env.JWT_SECRET || "changeme"

        // üß© Hash du mot de passe
        async function hashPassword(password: string) {
          return await bcrypt.hash(password, 10)
        }

        // ‚úÖ V√©rification du mot de passe
        async function verifyPassword(password: string, hash: string) {
          return await bcrypt.compare(password, hash)
        }

        // üîë G√©n√©ration du token JWT
        function generateAccessToken(userId: string) {
          return jwt.sign({ userId }, JWT_SECRET, { expiresIn: "15m" })
        }

        // üîÅ G√©n√©ration du refresh token
        function generateRefreshToken(userId: string) {
          return jwt.sign({ userId, type: "refresh" }, JWT_SECRET, { expiresIn: "7d" })
        }
        ```

  - type: input
    id: env_vars
    attributes:
      label: Variables d'environnement √† ajouter
      description: Cl√©s n√©cessaires pour la signature des tokens.
      placeholder: JWT_SECRET="un_secret_tr√®s_long_et_s√©curis√©"
    validations:
      required: true

  - type: markdown
    attributes:
      value: |
        ---
        ‚úÖ **Checklist :**
        - [ ] Hash du mot de passe fonctionnel √† l‚Äôinscription
        - [ ] V√©rification correcte √† la connexion
        - [ ] JWT sign√© avec `JWT_SECRET`
        - [ ] Refresh token stock√© et valid√©
        - [ ] Routes prot√©g√©es accessibles uniquement avec un JWT valide
